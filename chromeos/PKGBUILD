# Maintainer: Robert Pitt <robertpitt1988@gmail.com>
# Contributor: Necopinus <nathan@ecopunk.info>
# Contributor: danyf90 <daniele.formichelli@gmail.com>
# Contributor: wenLiangcan <boxeed@gmail.com>

pkgname=chromeos
pkgver=1.0.0
pkgrel=2.1
pkgdesc="Installs Chromium OS browser. Adds shortcuts to user login, which enables Chromium OS UI right from the start."
url="https://plus.google.com/+RobertPitt"
depends=(
		'matchbox-window-manager'
		'curl'
		'python'
		'python-dbus'
		'unzip'
		'libudev.so.0'
)
#matchbox-window-manager, curl, python3, python-dbus
optdepends=('google-chrome-stable: Google Chrome browser'
			'google-talkplugin: Hangouts, Google Talk plugin. Bound to chromeos'
			"chromium-pepper-flash-stable: Google Chrome's Pepper Flash plugin for Chromium (stable version)"
			'chromium-libpdf: A PDF Viewer for Chromium and Chromium based browsers')
arch=('x86_64')
license=('GPL')
md5sums=('3a827c37b56c2a65da03a7a431601c5b')
source=(wrap.zip)

build() {
	cd ${srcdir}

	msg "Finding latst ChromeOS Build"
	LKGR=$(curl --silent http://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_ChromiumOS/LAST_CHANGE)
	URL="http://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_ChromiumOS/${LKGR}/chrome-linux.zip"

	msg "Downloading Chrome OS... Build: $LKGR"
	curl --silent -z "chrome-linux.zip" -o "chrome-linux.zip" -L "$URL"
	
	msg "Extracting Chrome OS... Build: $LKGR"
	unzip -qq "chrome-linux.zip" -d "$srcdir/opt"
}

package() {
	#Move the chrome os
	msg "Creating package structure"
	mv "$srcdir/opt" "$pkgdir"
	mv "$srcdir/usr" "$pkgdir"
	mv "$pkgdir/opt/chrome-linux" "$pkgdir/opt/chromeos"

	msg "Fixing file permissions..."
	chmod 775 -R "$pkgdir/opt/chromeos"
	chown root:root "$pkgdir/usr/bin/chromeos"
	chown root:root "$pkgdir/usr/bin/chromeos-dm"
	chown root:root "$pkgdir/usr/bin/chromeos-plain"
	chown root:root "$pkgdir/usr/share/xsessions/chromeos.desktop"
}
